% import char packages
\usepackage[T1]{fontenc}
\usepackage[latin9]{luainputenc}

% Font package: fourier by default which uses Adobe Utopia
\usepackage{fourier}

% https://ctan.org/pkg/microtype?lang=en
\usepackage{microtype}

% \caps{Small Caps}, \so{letter_spacing}, \ul{underline}, \st{overstriking}
\usepackage{soul}

% for tables: https://ctan.org/pkg/array?lang=en, https://ctan.org/pkg/multirow, https://ctan.org/pkg/booktabs
\usepackage{array}
\usepackage{multirow}
\usepackage{booktabs}
    \newcommand\mytablefontsize{\normalsize}
    % \AtBeginEnvironment{table}{\mytablefontsize}

% support for placement of figures/tables: https://ctan.org/pkg/float
\usepackage{float}

% for line-spacing: \singlespacing, \doublespacing, \onehalfspacing
\usepackage{setspace}
    \linespread{1.4}
    
% for landscape figures/tables https://ctan.org/pkg/lscape
\usepackage{lscape}
% rotate landscape pages in the pdf
\usepackage{pdflscape}

% nice fractions
\usepackage{nicefrac}

% for math environments and operators: https://ctan.org/pkg/amsmath
% envs: equation, align, gather, multiline, alignat, flalign, split
\usepackage{amsmath}
    % allow for page breaks in the middle of equation blocks
    \allowdisplaybreaks[1]

\usepackage{mathtools}

% bold greek letter: e.g., \bm{\delta}
\usepackage{bm}

% for theorems: https://ctan.org/pkg/amsthm, https://ctan.org/pkg/thmtools
\usepackage{amsthm}
\usepackage{thmtools}
    % theorem/proposition style - colored with blue
    \declaretheoremstyle[
    spaceabove=2pt, spacebelow=2pt,
    headfont=\color{darkblue}\normalfont\bfseries,
    notefont=\color{textmagenta}\mdseries, notebraces={(}{)},
    bodyfont=\color{darkblue}\normalfont
    ]{thmstyle}

    % lemma, corollary style
    \declaretheoremstyle[
    spaceabove=2pt, spacebelow=2pt,
    headfont=\normalfont\bfseries,
    notefont=\mdseries\bfseries\itshape, notebraces={(}{)},
    bodyfont=\normalfont\itshape,
    ]{thmstyleblk}

    % envs: thm, prop, remark, lem, cor, defn, defn*, algorithm, proof
    \declaretheorem[style=thmstyle,name=Theorem]{thm}
    \declaretheorem[style=thmstyle,name=Proposition]{prop}
    \declaretheorem[style=thmstyleblk,name=Remark]{remark}
    \declaretheorem[style=thmstyle,name=Lemma]{lem}
    \declaretheorem[style=thmstyle,name=Corollary]{cor}
    \declaretheorem[style=thmstyle,name=Definition]{defn}
    \declaretheorem[style=thmstyle,name=Assumption]{asm}
    \declaretheorem[style=thmstyle,name=Definition,numbered=no]{defn*}
    \declaretheorem[style=thmstyle,name=Algorithm]{algorithm}
    \renewcommand{\qedsymbol}{\rule{1.2ex}{1.2ex}}
    \renewenvironment{proof}[1][\proofname]{\par
        \pushQED{\qed}%
        \normalfont \topsep2\p@\@plus6\p@\relax
        \trivlist
        \item\relax
        {\itshape
        #1\@addpunct{.}}\hspace\labelsep\ignorespaces
        }{%
        \popQED\endtrivlist\@endpefalse
    }

% for mathemtical symbols
\usepackage{amssymb}

% for bibliography
\usepackage[longnamesfirst,authoryear]{natbib}
    \setcitestyle{citesep={,}}
	\setlength{\bibsep}{1.5pt plus 0.3ex}
    \newcommand{\printreferences}{
        \begin{singlespace}
        {\footnotesize
        \bibliographystyle{\mybibstyle}
        \bibliography{\mybibfile}}
        \end{singlespace}
    }

% to import tex files into main.tex
\usepackage{import}

% to have colored hyperlinks
\usepackage{hyperref}
    \newcommand{\linkcolor}{darkred}
    \newcommand{\citecolor}{darkred}
    \newcommand{\urlcolor}{textmagenta}
    \hypersetup{colorlinks=true,linkcolor=\linkcolor,citecolor=\citecolor,urlcolor=\urlcolor}
    \newcommand{\email}[1]{\href{mailto:#1}{#1}}

% clever references
\usepackage[capitalise,noabbrev,nameinlink]{cleveref}
    \crefname{thm}{Theorem}{Theorems}
    \crefname{lem}{Lemma}{Lemmas}
    \crefname{cor}{Corollary}{Corollaries}
    \crefname{asm}{Assumption}{Assumptions}
    \crefname{defn}{Definition}{Definitions}
    \crefname{prop}{Proposition}{Propositions}
    \crefname{remark}{Remark}{Remarks}
    \crefname{comment}{Comment}{Comments}

% for appendix: https://ctan.org/pkg/appendix, https://ctan.org/pkg/apptools
\usepackage{appendix} % \appendix
\usepackage{apptools} % \AtAppendix, \IfAppendix
    \AtAppendix{
        \onehalfspacing
        \counterwithin{prop}{section}
        \counterwithin{lem}{section}
        \counterwithin{cor}{section}
        \counterwithin{table}{section}
        \counterwithin{figure}{section}
        \numberwithin{equation}{section}
    }
    \newcommand{\onlineappendixheader}{
        \newpage
        \thispagestyle{empty}
        \vspace*{\fill}
        \begin{center}
        \textbf{{\huge APPENDIX}  \\ {\Large(FOR ONLINE PUBLICATION)}}
        \end{center}
        \vspace*{\fill}
        \newpage
    }

% for captions:
\usepackage{caption}
    \captionsetup{belowskip=5pt,aboveskip=5pt}
    % for table and figure notes:
    \newcommand\notes[1]{\captionsetup{belowskip=5pt,aboveskip=5pt,font={footnotesize,stretch=1},justification=justified}\caption*{\emph{Notes:} #1}}
\usepackage{subcaption}

% for plots and figures:
\usepackage{tikz}
\usetikzlibrary{arrows.meta}
\usepackage{pgfplots}
    \pgfplotsset{compat=1.16}

% could be used to redefine url styles: https://ctan.org/pkg/url
\usepackage{url}

% no space between items in lists (itemize, enumerate)
\usepackage[inline]{enumitem}
    \setlist{nosep}

% where to compile eps figures to pdf
\usepackage[outdir=./build/]{epstopdf}

% for margins (see declare options below)
\usepackage{geometry}
    \geometry{tmargin=0.9in,bmargin=0.9in,lmargin=0.9in,rmargin=0.9in}

% options for \includegraphics: https://ctan.org/pkg/graphicx
\usepackage{graphicx}
    \newcommand\myfigurescale{1}
    \setkeys{Gin}{width=\myfigurescale\textwidth}

% \usepackage{xcolor}

%% PRETTY COLORS
\definecolor{darkred}{rgb}{0.6, 0, 0}
\definecolor{darkblue}{rgb}{0, 0, 0.6}
\definecolor{textmagenta}{rgb}{0.55, 0.0, 0.55}
\definecolor{darkmagenta}{HTML}{8f2247}
\definecolor{lightblue}{HTML}{B5D3E7}
\definecolor{lightred}{HTML}{FFCCCB}
\definecolor{darkgreen}{rgb}{0.1, 0.25, 0.1}


%% DECLARE OPTIONS
% if for building the title page
\newif\ifbuildtitle
\buildtitletrue
\DeclareOption{note}{\buildtitlefalse}

% option for writing response letters to referee reorts 
% adds two commnads: \comment{quote referee comment here} and \response{write your response here}
\DeclareOption{response}{\buildtitlefalse
    \NewDocumentCommand{\comment}{m !o}{
        \IfValueTF{#2}{%
            \paragraph{Comment~#1\,\,(#2).}
        }{%
            \paragraph*{Comment~#1.}
        }%
        }
    \newenvironment{response}{\color{darkblue}\paragraph{\textnormal{\textbf{Response.}}}}{}
    \newcommand{\nl}{\medskip \\}
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{0.5\baselineskip}
}

% if for saving space
\newif\ifcompact
\compactfalse
\DeclareOption{compact}{\compacttrue}
% if for comments
\newif\ifcomments
\commentsfalse
\DeclareOption{comments}{\commentstrue}
% if for no abstract
\newif\ifnoabstract
\noabstractfalse
\DeclareOption{noabstract}{\noabstracttrue}

\DeclareOption{ecma}{
    \geometry{tmargin=1.5in,bmargin=1.5in,lmargin=1.5in,rmargin=1.5in}
    }

\DeclareOption{aer}{
    \geometry{tmargin=1.25in,bmargin=1.25in,lmargin=1.25in,rmargin=1.25in}
    }

\DeclareOption{qje}{
    % ROMAN NUMBERS FOR QJE
    \renewcommand{\thetable}{\Roman{table}}
    \renewcommand{\thefigure}{\Roman{figure}}
    }
\ProcessOptions\relax
%% TITLE/AUTHORS/AFFILIATIONS
%% MAKE TITLE
\ifbuildtitle

\title{\mytitle\thanks{\mytitlefootnote}}
\author{\myauthors}
\date{\normalsize{\mydate}}
    \ifnoabstract
    \AtBeginDocument{
        \maketitle
        \pagenumbering{arabic}
    }
    \else
    \AtBeginDocument{
        \maketitle
        \thispagestyle{empty}
        \begin{abstract}
            \begin{singlespace}
        \myabstract
        \vspace{\baselineskip} \\
        \noindent \emph{JEL Codes:} \myjelcodes \\
        \noindent \emph{Key Words:} \mykeywords
            \end{singlespace}
        \end{abstract}
        \newpage{}
        \pagenumbering{arabic}
    }
    \fi
\fi

%%COMPACT FOR SAVING SPACE
% control space before and after equation environments:
\usepackage{etoolbox}
% space before and after section/subsection/paragraph titles
\usepackage{titlesec}
\ifcompact
    % \DeclareMathSizes{12}{11}{8}{7}
    \newcommand{\zerodisplayskips}{%
    \setlength{\abovedisplayskip}{1ex}%
    \setlength{\belowdisplayskip}{1ex}%
    \setlength{\abovedisplayshortskip}{1ex}%
    \setlength{\belowdisplayshortskip}{1ex}}
    \appto{\normalsize}{\zerodisplayskips}
    \appto{\small}{\zerodisplayskips}
    \appto{\footnotesize}{\zerodisplayskips}
    \titlespacing*{\section}{0pt}{3ex plus 0.6ex minus .2ex}{1ex plus 0.6ex minus .2ex}
    \titlespacing*{\subsection}{0pt}{1.2ex plus 0.6ex minus .2ex}{0.8ex plus 0.5ex minus .2ex}
    \titlespacing*{\subsubsection}{0pt}{0.8ex plus 0.6ex minus .2ex}{0.8ex plus 0.5ex minus .2ex}
    \titlespacing*{\paragraph}{0pt}{0.5ex plus .2ex minus .2ex}{0.5ex plus 0.2ex minus .2ex}
    \titlespacing*{\subparagraph}{20pt}{0.5ex plus .2ex minus .2ex}{0.5ex plus 0.2ex minus .2ex}
    \let\newlarge\large
    \renewcommand\newlarge{\@setfontsize\large{15}{15}}
    \titleformat{\section}{\newlarge\bfseries}{\thesection}{15pt}{}
    \titleformat{\subsection}{\normalsize\bfseries}{\thesubsection.}{5pt}{}
    \titleformat{\subsubsection}[runin]{\normalsize\bfseries}{\thesubsubsection.}{5pt}{}[.]
    \titleformat*{\paragraph}{\normalsize\bfseries}
    \titleformat*{\subparagraph}{\normalsize\itshape}
\fi



%%EXPAND THE MARGIN FOR COMMENTS
\ifcomments
  \paperwidth=\dimexpr \paperwidth + 3cm\relax
  \oddsidemargin=\dimexpr\oddsidemargin \relax
  \evensidemargin=\dimexpr\evensidemargin + 3cm\relax
  \marginparwidth=\dimexpr \marginparwidth + 3cm\relax
  \usepackage{todonotes}
\else
  \usepackage[disable]{todonotes}
\fi

% define comment author: \commentauthor{Author}{command}{color}
\newcommand{\commentauthor}[3]{
    \newcommand{#2}[1]{\todo[color=#3!30, size=\scriptsize]
     {\begin{spacing}{1}\textbf{#1:} \\ \texttt{##1}\end{spacing}}}
}



%%% CUSTOM COMMANDS
% upright diff operator; e.g., \d j vs dj
\usepackage{xparse}
\renewcommand{\d}{\mathrm{d}}
				
% mathbf expectation operator
\newcommand{\E}{\mathbb{E}}

% highlighted math; e.g., \mcolor{...}
\newcommand{\mcolor}[1]{{\color{textmagenta} #1}}

% circled number for explanation in text 
\newcommand*\circled[1]{\tikz[baseline=(char.base)]{
            \node[shape=circle,draw,inner sep=2pt,color=darkred] (char) {\scriptsize #1};}}

% partical derivative 
\NewDocumentCommand{\pd}{m !o}{
  \IfValueTF{#2}{%
    \frac{\partial #2}{\partial #1}
  }{%
    \frac{\partial}{\partial #1}
  }%
}
\newcommand{\bigo}[2]{\mathcal{O}\pr{\left\|#1\right\|^#2}}

% total derivative
\newcommand{\td}[1]{\frac{\d}{\d #1}}

% automatically adjusted parenthesis 
\newcommand{\pr}[1]{\left( #1 \right)}

% automaticall adjusted brackets
\newcommand{\br}[1]{\left[ #1 \right]}

% align and align* with \textstyle
\newenvironment{talign}
 {\let\displaystyle\textstyle\align}
 {\endalign}
\newenvironment{talign*}
 {\let\displaystyle\textstyle\csname align*\endcsname}
 {\endalign}


 %%% DEPRECATED: don't use. only here for old versions
 \newcommand{\eqlabel}[2]{\underbrace{#2}_{\text{#1}}}